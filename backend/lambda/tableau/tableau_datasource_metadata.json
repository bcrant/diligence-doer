{"0b45ffbf-7a70-4d66-9b03-9c391fa87e8e": {"datasource_id": "0b45ffbf-7a70-4d66-9b03-9c391fa87e8e", "datasource_name": "questions (staging_evalufi)", "source_table_names_list": ["public.question_translations"], "source_field_names_list": ["media", "updated_at", "incorrect_feedback_text", "text", "question_id", "locale", "id", "created_at"], "initial_sql": [], "custom_sql": []}, "3c3cd644-2011-438d-8d85-e47436f5ddc0": {"datasource_id": "3c3cd644-2011-438d-8d85-e47436f5ddc0", "datasource_name": "messages (staging_notifi)", "source_table_names_list": ["public.messages"], "source_field_names_list": ["locked", "updated_at", "markdown_enabled", "sender_id", "body", "subject", "slug", "theme", "id", "created_at", "deliver_via"], "initial_sql": [], "custom_sql": []}, "456ccde4-f98b-4f8c-92f4-e7a8149aa207": {"datasource_id": "456ccde4-f98b-4f8c-92f4-e7a8149aa207", "datasource_name": "program_users (staging_next)", "source_table_names_list": ["public.program_users"], "source_field_names_list": ["updated_at", "program_id", "id", "user_id", "created_at"], "initial_sql": [], "custom_sql": []}, "89abfc50-8fcc-4c9e-bc35-31722ae917c4": {"datasource_id": "89abfc50-8fcc-4c9e-bc35-31722ae917c4", "datasource_name": "Action Plan - Redshift HR Staging", "source_table_names_list": ["homeroom_data.users", "homeroom_data.sponsorships", "homeroom_data.cohorts", "homeroom_data.action_plan_item_responses", "homeroom_data.content_module_translations", "homeroom_data.action_plan_topics", "homeroom_data.enrollments", "homeroom_data.content_modules", "homeroom_data.action_plan_items", "homeroom_data.sponsors", "homeroom_data.schools", "action_plan_item"], "source_field_names_list": ["homeroom_data.schools.name", "homeroom_data.content_modules.id", "BODY", "action_plan_item.cohort_id", "homeroom_data.sponsors.id", "enrollment_id", "homeroom_data.action_plan_topics.module_id", "homeroom_data.schools.created_at", "apr.sponsor_name", "homeroom_data.content_module_translations.content_module_id", "homeroom_data.users.deleted_at", "locale", "[Calculated Field] Action Plan + Body", "schools.sponsor_1_id", "homeroom_data.schools.sponsor_2_id", "apr.school_name", "action_plan_item.school_name", "homeroom_data.enrollments.user_id", "schools.account_manager_id", "schools.name", "sponsor_name", "action_plan_item_id", "homeroom_data.cohorts.deleted_at", "module_id", "apr.sponsor_2_id", "cohort_id", "schools.sponsor_2_id", "content_module_title", "school_id", "homeroom_data.cohorts.school_id", "apr.id", "created_at", "apr.cohort_id", "homeroom_data.sponsors.name", "id", "schools.id", "action_plan_item.created_at", "*", "homeroom_data.sponsors.internal_sample", "homeroom_data.content_modules.title", "homeroom_data.action_plan_topics.id", "homeroom_data.enrollments.cohort_id", "action_plan_topic_id", "homeroom_data.enrollments.created_at", "account_manager_id", "apr.state", "action_plan_item.account_manager_id", "[Calculated Field] Action Plan State", "action_plan_item.sponsor_1_id", "homeroom_data.sponsorships.deleted_at", "homeroom_data.sponsors.deleted_at", "org_id_2", "homeroom_data.sponsorships.sponsor_id", "action_plan_item.enrollment_id", "homeroom_data.schools.id", "action_plan_item.action_plan_item_id", "action_plan_item.sponsor_name", "homeroom_data.schools.sponsor_1_id", "action_plan_item.action_plan_topic_id", "action_plan_item.state", "school_name", "action_plan_item.id", "action_plan_item.school_id", "homeroom_data.enrollments.id", "apr.school_id", "action_plan_item.sponsor_2_id", "[Calculated Field] # of Action Plan Items", "homeroom_data.schools.sponsor_name", "apr.created_at", "homeroom_data.content_module_translations.locale", "homeroom_data.sponsorships.curriculum_id", "homeroom_data.enrollments.deleted_at", "apr.account_manager_id", "[Calculated Field] Index", "apr.sponsor_1_id", "state", "apr.action_plan_item_id", "homeroom_data.users.id", "schools.sponsor_name", "homeroom_data.cohorts.curriculum_id", "homeroom_data.cohorts.id", "action_plan_item.body", "homeroom_data.sponsorships.school_id", "homeroom_data.schools.account_manager_id"], "initial_sql": [], "custom_sql": ["WITH schools AS\n  (SELECT sponsors.name AS sponsor_name\n        ,  schools.id, schools.id AS school_id\n                     ,  schools.name\n                     ,  schools.account_manager_id\n                     ,  schools.created_at, min(sponsors.id) AS sponsor_1_id\n                                          ,  CASE\n                                                 WHEN count(*) >> 1 THEN max(sponsors.id)\n                                             END AS sponsor_2_id\n   FROM homeroom_data.schools schools\n   JOIN homeroom_data.sponsorships sponsorships ON sponsorships.school_id = schools.id\n   AND sponsorships.curriculum_id = 2\n   AND sponsorships.deleted_at IS NULL\n   JOIN homeroom_data.sponsors sponsors ON sponsors.id = sponsorships.sponsor_id\n   AND NOT sponsors.internal_sample\n   AND sponsors.deleted_at IS NULL\n   GROUP BY schools.id\n          ,  schools.name\n          ,  schools.account_manager_id\n          ,  schools.created_at\n          ,  sponsors.name)\n   ,  Enrollments AS\n  (SELECT schools.sponsor_name\n        ,  enrollments.id\n        ,  enrollments.created_at, cohorts.id AS cohort_id\n                                 ,  schools.sponsor_1_id\n                                 ,  schools.sponsor_2_id\n                                 ,  schools.id AS school_id\n                                 ,  schools.account_manager_id\n                                 ,  schools.name AS school_name\n   FROM homeroom_data.enrollments enrollments\n   JOIN homeroom_data.users users ON enrollments.user_id = users.id\n   JOIN homeroom_data.cohorts cohorts ON enrollments.cohort_id = cohorts.id\n   JOIN schools ON cohorts.school_id = schools.id\n   WHERE enrollments.deleted_at IS NULL\n     AND cohorts.deleted_at IS NULL\n     AND users.deleted_at IS NULL\n     AND cohorts.curriculum_id = 2 )\n   ,  Action_Plan_Responses AS\n  (SELECT Enrollments.id\n        ,  Enrollments.created_at\n        ,  Enrollments.cohort_id\n        ,  Enrollments.sponsor_1_id\n        ,  Enrollments.sponsor_2_id\n        ,  Enrollments. school_id\n        ,  Enrollments.school_name\n        ,  Enrollments.account_manager_id\n        ,  api.action_plan_item_id\n        ,  api.state\n        ,  Enrollments.sponsor_name\n   FROM Enrollments\n   LEFT OUTER JOIN homeroom_data.action_plan_item_responses api ON Enrollments.id = api.enrollment_id)\n   ,  Action_Plan_Item AS\n  (SELECT apr.id\n        ,  apr.created_at\n        ,  apr.cohort_id\n        ,  apr.sponsor_1_id\n        ,  apr.sponsor_2_id\n        ,  apr. school_id\n        ,  apr.school_name\n        ,  apr.account_manager_id\n        ,  apr.action_plan_item_id\n        ,  apr.state\n        ,  api.body\n        ,  api.action_plan_topic_id\n        ,  apr.sponsor_name\n   FROM Action_Plan_Responses apr\n   LEFT OUTER JOIN homeroom_data.action_plan_items api ON apr.action_plan_item_id = api.id)\n   ,  action_plan_modules AS\n  (SELECT api.id\n        ,  api.created_at\n        ,  api.cohort_id\n        ,  api.sponsor_name\n        ,  api.sponsor_1_id\n        ,  api.sponsor_2_id\n        ,  api. school_id\n        ,  api.school_name\n        ,  api.account_manager_id\n        ,  api.action_plan_item_id\n        ,  api.state\n        ,  api.body\n        ,  api.action_plan_topic_id\n        ,  apt.module_id\n        ,  cm.title AS content_module_title\n        ,  cmt.locale\n   FROM action_plan_item api\n   LEFT JOIN homeroom_data.action_plan_topics apt ON api.action_plan_topic_id = apt.id\n   LEFT JOIN homeroom_data.content_modules cm ON apt.module_id = cm.id\n   LEFT JOIN homeroom_data.content_module_translations cmt ON cmt.content_module_id = cm.id)\n   ,  results AS\n  (SELECT id AS enrollment_id\n        ,  created_at\n        ,  cohort_id\n        ,  sponsor_name\n        ,  sponsor_1_id AS org_id\n        ,  sponsor_2_id AS org_id_2\n        ,  school_id\n        ,  school_name\n        ,  account_manager_id\n        ,  action_plan_item_id\n        ,  state\n        ,  BODY\n        ,  action_plan_topic_id\n        ,  module_id\n        ,  content_module_title\n        ,  locale\n   FROM action_plan_modules)\nSELECT *\nFROM results"]}, "c9c2d40c-89e7-4b0b-b337-cbfd08222ade": {"datasource_id": "c9c2d40c-89e7-4b0b-b337-cbfd08222ade", "datasource_name": "POC.redshift.homeroom_data.action_plan (local copy)", "source_table_names_list": ["homeroom_data.users", "homeroom_data.sponsorships", "homeroom_data.cohorts", "homeroom_data.action_plan_item_responses", "homeroom_data.content_module_translations", "homeroom_data.action_plan_topics", "homeroom_data.enrollments", "homeroom_data.content_modules", "homeroom_data.action_plan_items", "homeroom_data.sponsors", "homeroom_data.schools", "action_plan_item"], "source_field_names_list": ["homeroom_data.schools.name", "homeroom_data.content_modules.id", "BODY", "action_plan_item.cohort_id", "homeroom_data.sponsors.id", "enrollment_id", "homeroom_data.action_plan_topics.module_id", "homeroom_data.schools.created_at", "apr.sponsor_name", "homeroom_data.content_module_translations.content_module_id", "homeroom_data.users.deleted_at", "locale", "[Calculated Field] Action Plan + Body", "[Calculated Field] UserName Evaluation v2", "schools.sponsor_1_id", "homeroom_data.schools.sponsor_2_id", "apr.school_name", "action_plan_item.school_name", "homeroom_data.enrollments.user_id", "schools.account_manager_id", "schools.name", "sponsor_name", "org_id", "action_plan_item_id", "homeroom_data.cohorts.deleted_at", "module_id", "apr.sponsor_2_id", "cohort_id", "schools.sponsor_2_id", "content_module_title", "school_id", "homeroom_data.cohorts.school_id", "apr.id", "created_at", "apr.cohort_id", "homeroom_data.sponsors.name", "id", "schools.id", "action_plan_item.created_at", "homeroom_data.sponsors.internal_sample", "homeroom_data.content_modules.title", "homeroom_data.action_plan_topics.id", "homeroom_data.enrollments.cohort_id", "action_plan_topic_id", "homeroom_data.enrollments.created_at", "account_manager_id", "apr.state", "action_plan_item.account_manager_id", "[Calculated Field] Action Plan State", "action_plan_item.sponsor_1_id", "homeroom_data.sponsorships.deleted_at", "homeroom_data.sponsors.deleted_at", "org_id_2", "homeroom_data.sponsorships.sponsor_id", "action_plan_item.enrollment_id", "homeroom_data.schools.id", "action_plan_item.action_plan_item_id", "action_plan_item.sponsor_name", "homeroom_data.schools.sponsor_1_id", "action_plan_item.action_plan_topic_id", "action_plan_item.state", "school_name", "action_plan_item.id", "action_plan_item.school_id", "homeroom_data.enrollments.id", "apr.school_id", "action_plan_item.sponsor_2_id", "[Calculated Field] # of Action Plan Items", "homeroom_data.schools.sponsor_name", "apr.created_at", "homeroom_data.content_module_translations.locale", "homeroom_data.sponsorships.curriculum_id", "homeroom_data.enrollments.deleted_at", "apr.account_manager_id", "[Calculated Field] Index", "apr.sponsor_1_id", "state", "[Calculated Field] UserName Evaluation", "apr.action_plan_item_id", "homeroom_data.users.id", "schools.sponsor_name", "homeroom_data.cohorts.curriculum_id", "homeroom_data.cohorts.id", "action_plan_item.body", "homeroom_data.sponsorships.school_id", "homeroom_data.schools.account_manager_id"], "initial_sql": [], "custom_sql": ["WITH schools AS\n  (SELECT sponsors.name AS sponsor_name\n        ,  schools.id, schools.id AS school_id\n                     ,  schools.name\n                     ,  schools.account_manager_id\n                     ,  schools.created_at, min(sponsors.id) AS sponsor_1_id\n                                          ,  CASE\n                                                 WHEN count(*) >> 1 THEN max(sponsors.id)\n                                             END AS sponsor_2_id\n   FROM homeroom_data.schools schools\n   JOIN homeroom_data.sponsorships sponsorships ON sponsorships.school_id = schools.id\n   AND sponsorships.curriculum_id = 2\n   AND sponsorships.deleted_at IS NULL\n   JOIN homeroom_data.sponsors sponsors ON sponsors.id = sponsorships.sponsor_id\n   AND NOT sponsors.internal_sample\n   AND sponsors.deleted_at IS NULL\n   GROUP BY schools.id\n          ,  schools.name\n          ,  schools.account_manager_id\n          ,  schools.created_at\n          ,  sponsors.name)\n   ,  Enrollments AS\n  (SELECT schools.sponsor_name\n        ,  enrollments.id\n        ,  enrollments.created_at, cohorts.id AS cohort_id\n                                 ,  schools.sponsor_1_id\n                                 ,  schools.sponsor_2_id\n                                 ,  schools.id AS school_id\n                                 ,  schools.account_manager_id\n                                 ,  schools.name AS school_name\n   FROM homeroom_data.enrollments enrollments\n   JOIN homeroom_data.users users ON enrollments.user_id = users.id\n   JOIN homeroom_data.cohorts cohorts ON enrollments.cohort_id = cohorts.id\n   JOIN schools ON cohorts.school_id = schools.id\n   WHERE enrollments.deleted_at IS NULL\n     AND cohorts.deleted_at IS NULL\n     AND users.deleted_at IS NULL\n     AND cohorts.curriculum_id = 2 )\n   ,  Action_Plan_Responses AS\n  (SELECT Enrollments.id\n        ,  Enrollments.created_at\n        ,  Enrollments.cohort_id\n        ,  Enrollments.sponsor_1_id\n        ,  Enrollments.sponsor_2_id\n        ,  Enrollments. school_id\n        ,  Enrollments.school_name\n        ,  Enrollments.account_manager_id\n        ,  api.action_plan_item_id\n        ,  api.state\n        ,  Enrollments.sponsor_name\n   FROM Enrollments\n   LEFT OUTER JOIN homeroom_data.action_plan_item_responses api ON Enrollments.id = api.enrollment_id)\n   ,  Action_Plan_Item AS\n  (SELECT apr.id\n        ,  apr.created_at\n        ,  apr.cohort_id\n        ,  apr.sponsor_1_id\n        ,  apr.sponsor_2_id\n        ,  apr. school_id\n        ,  apr.school_name\n        ,  apr.account_manager_id\n        ,  apr.action_plan_item_id\n        ,  apr.state\n        ,  api.body\n        ,  api.action_plan_topic_id\n        ,  apr.sponsor_name\n   FROM Action_Plan_Responses apr\n   LEFT OUTER JOIN homeroom_data.action_plan_items api ON apr.action_plan_item_id = api.id)\n   ,  action_plan_modules AS\n  (SELECT api.id\n        ,  api.created_at\n        ,  api.cohort_id\n        ,  api.sponsor_name\n        ,  api.sponsor_1_id\n        ,  api.sponsor_2_id\n        ,  api. school_id\n        ,  api.school_name\n        ,  api.account_manager_id\n        ,  api.action_plan_item_id\n        ,  api.state\n        ,  api.body\n        ,  api.action_plan_topic_id\n        ,  apt.module_id\n        ,  cm.title AS content_module_title\n        ,  cmt.locale\n   FROM action_plan_item api\n   LEFT JOIN homeroom_data.action_plan_topics apt ON api.action_plan_topic_id = apt.id\n   LEFT JOIN homeroom_data.content_modules cm ON apt.module_id = cm.id\n   LEFT JOIN homeroom_data.content_module_translations cmt ON cmt.content_module_id = cm.id)\n   ,  results AS\n  (SELECT id AS enrollment_id\n        ,  created_at\n        ,  cohort_id\n        ,  sponsor_name\n        ,  sponsor_1_id AS org_id\n        ,  sponsor_2_id AS org_id_2\n        ,  school_id\n        ,  school_name\n        ,  account_manager_id\n        ,  action_plan_item_id\n        ,  state\n        ,  BODY\n        ,  action_plan_topic_id\n        ,  module_id\n        ,  content_module_title\n        ,  locale\n   FROM action_plan_modules)\nSELECT enrollment_id\n     , created_at\n     , cohort_id\n     , sponsor_name\n     , CASE CAST(org_id AS VARCHAR)\n           WHEN 587 THEN 'a5e9af5c-a672-483f-8fa4-10d32247d757'\n           ELSE CAST(org_id AS VARCHAR)\n       END AS org_id\n     , org_id_2\n     , school_id\n     , school_name\n     , account_manager_id\n     , action_plan_item_id\n     , state\n     , BODY\n     , action_plan_topic_id\n     , module_id\n     , content_module_title\n     , locale\nFROM results"]}, "c157c5f6-70e2-4bcb-8b9d-67cad58f7e07": {"datasource_id": "c157c5f6-70e2-4bcb-8b9d-67cad58f7e07", "datasource_name": "atwork_program_incentive_activity", "source_table_names_list": ["ods.dim_program_qna_texts", "analyst_data.dim_atwork_playlists", "analyst_data.dim_incentives", "analyst_data.dim_organizations", "analyst_data.dim_atwork_visits", "analyst_data.dim_dates", "analyst_data.fact_incentive_activity", "analyst_data.dim_programs"], "source_field_names_list": ["analyst_data.fact_incentive_activity.playlist_key", "analyst_data.fact_incentive_activity.incentive_detail_link_clicks", "analyst_data.dim_atwork_visits.visit_id", "ods.dim_program_qna_texts.program_qna_key", "analyst_data.dim_dates.date", "analyst_data.fact_incentive_activity.incentive_key", "analyst_data.dim_organizations.organization_uuid", "analyst_data.fact_incentive_activity.incentive_playlist_starts", "analyst_data.dim_organizations.organization_id", "analyst_data.fact_incentive_activity.zip_qna_key", "ods.dim_program_qna_texts.program_question_answer_response_text", "analyst_data.fact_incentive_activity.incentive_qualification_detail_link_click", "analyst_data.fact_incentive_activity.source", "analyst_data.dim_atwork_visits.visit_account_id", "analyst_data.dim_atwork_playlists.playlist_key", "analyst_data.fact_incentive_activity.income_qna_key", "analyst_data.dim_programs.program_name", "analyst_data.fact_incentive_activity.detail_visit_key", "analyst_data.fact_incentive_activity.age_qna_key", "analyst_data.fact_incentive_activity.qualification_visit_key", "analyst_data.dim_programs.program_key", "analyst_data.dim_dates.date_key", "analyst_data.dim_organizations.organization_key", "analyst_data.dim_atwork_visits.visit_program_id", "analyst_data.fact_incentive_activity.date_key", "analyst_data.dim_programs.program_id", "analyst_data.dim_incentives.incentive_title", "analyst_data.dim_atwork_playlists.playlist_name", "analyst_data.fact_incentive_activity.incentive_playlist_qualifications", "analyst_data.fact_incentive_activity.organization_key", "analyst_data.dim_atwork_visits.visit_started_at", "analyst_data.fact_incentive_activity.program_key", "analyst_data.dim_incentives.incentive_key", "analyst_data.dim_organizations.organization_name", "NULL"], "initial_sql": [], "custom_sql": ["SELECT dates.date AS activity_date\n     , dim_organizations.organization_uuid AS organization_uuid\n     , dim_organizations.organization_name AS organization_name\n     , dim_programs.program_name AS program_name\n     , dim_playlists.playlist_name AS playlist_name\n     , incentive_activity.incentive_key\n     , dim_incentives.incentive_title AS incentive_title\n     , incentive_activity.incentive_playlist_starts AS incentive_playlist_starts\n     , incentive_activity.incentive_playlist_qualifications AS incentive_playlist_qualifications\n     , incentive_activity.incentive_detail_link_clicks AS incentive_detail_link_clicks\n     , incentive_activity.detail_visit_key AS incentive_detail_link_click_visit\n     , incentive_activity.incentive_qualification_detail_link_click AS incentive_qualification_detail_link_clicks\n     , incentive_activity.qualification_visit_key AS incentive_qualification_detail_link_clicks_visit\n     , incentive_activity.source AS SOURCE\n     , NULL AS contact_method\n     , age_qna.program_question_answer_response_text AS age\n     , income_qna.program_question_answer_response_text AS income\n     , postal_code_qna.program_question_answer_response_text AS postal_code\n     , COUNT(DISTINCT visit_info.visit_id) AS incentivized_visits\nFROM analyst_data.fact_incentive_activity AS incentive_activity\nJOIN analyst_data.dim_dates AS dates ON incentive_activity.date_key = dates.date_key\nJOIN analyst_data.dim_organizations AS dim_organizations ON incentive_activity.organization_key = dim_organizations.organization_key\nJOIN analyst_data.dim_programs AS dim_programs ON incentive_activity.program_key = dim_programs.program_key\nJOIN analyst_data.dim_atwork_playlists AS dim_playlists ON incentive_activity.playlist_key = dim_playlists.playlist_key\nJOIN analyst_data.dim_incentives AS dim_incentives ON incentive_activity.incentive_key = dim_incentives.incentive_key\nLEFT JOIN ods.dim_program_qna_texts AS age_qna ON incentive_activity.age_qna_key = age_qna.program_qna_key\nLEFT JOIN ods.dim_program_qna_texts AS income_qna ON incentive_activity.income_qna_key = income_qna.program_qna_key\nLEFT JOIN ods.dim_program_qna_texts AS postal_code_qna ON incentive_activity.zip_qna_key = postal_code_qna.program_qna_key\nLEFT JOIN\n  (SELECT CAST(atwork_visits.visit_started_at AS DATE) AS visit_started_at\n        , atwork_visits.visit_account_id\n        , atwork_visits.visit_program_id\n        , atwork_visits.visit_id\n   FROM analyst_data.dim_atwork_visits AS atwork_visits) AS visit_info ON visit_info.visit_started_at = dates.date\nAND visit_info.visit_account_id = dim_organizations.organization_id\nAND visit_info.visit_program_id = dim_programs.program_id\nGROUP BY dates.date\n       , dim_organizations.organization_uuid\n       , dim_organizations.organization_name\n       , dim_programs.program_name\n       , dim_playlists.playlist_name\n       , incentive_activity.incentive_key\n       , dim_incentives.incentive_title\n       , incentive_activity.incentive_playlist_starts\n       , incentive_activity.incentive_playlist_qualifications\n       , incentive_activity.incentive_detail_link_clicks\n       , incentive_activity.detail_visit_key\n       , incentive_activity.incentive_qualification_detail_link_click\n       , incentive_activity.qualification_visit_key\n       , incentive_activity.source\n       , age_qna.program_question_answer_response_text\n       , income_qna.program_question_answer_response_text\n       , postal_code_qna.program_question_answer_response_text"]}, "f7e36cbb-d21c-48b6-96c0-862c975ace21": {"datasource_id": "f7e36cbb-d21c-48b6-96c0-862c975ace21", "datasource_name": "atwork_incentive_activity", "source_table_names_list": ["adminifi_data.users"], "source_field_names_list": ["learner_user_id", "[Calculated Field] URLS", "organization_uuid"], "initial_sql": [], "custom_sql": ["SELECT next_incentives.start_date AS incentive_start_date\n     ,  next_incentives.end_date AS incentive_end_date\n     ,  next_incentive_activities.id AS incentive_activity_id\n     ,  next_incentive_activities.user_id AS learner_user_id\n     ,  next_account_translations.name AS organization_name\n     ,  next_accounts.organization_uuid AS organziation_uuid\n     ,  next_program_translation.name AS program_name\n     ,  next_playlist_translations.name AS playlist_name\n     ,  next_incentive_translations.title AS incentive_title\n     ,  NVL(next_users.first_name, adminifi_users.first_name) AS learner_first_name\n     ,  NVL(next_users.last_name, adminifi_users.last_name) AS learner_last_name\n     ,  next_incentive_activities.completion AS qualified_on_date_time\n     ,  next_question_translations.question_text AS question_text\n     ,  NVL(NVL(next_answer_translations.answer_text, json_extract_path_text(next_responses.data, 'free_text')), '') AS answer_text\nFROM next_data.incentives AS next_incentives\nJOIN next_data.incentive_translations AS next_incentive_translations ON next_incentives.id = next_incentive_translations.incentive_id\nAND next_incentive_translations.locale = 'en'\nJOIN next_data.incentive_activities AS next_incentive_activities ON next_incentives.id = next_incentive_activities.incentive_id\nAND next_incentive_activities.status = 2\nJOIN next_data.program_users ON program_users.user_id = next_incentive_activities.user_id\nAND program_users.program_id = next_incentives.program_id\nJOIN next_data.users AS next_users ON next_incentive_activities.user_id = next_users.id\nLEFT JOIN adminifi_data.users AS adminifi_users ON next_users.foundry_id = adminifi_users.uuid\nJOIN next_data.accounts AS next_accounts ON next_users.account_id = next_accounts.id\nLEFT JOIN next_data.account_translations AS next_account_translations ON next_accounts.id = next_account_translations.account_id\nAND next_account_translations.locale = 'en'\nJOIN next_data.playlists AS next_playlists ON next_incentives.playlist_id = next_playlists.id\nLEFT JOIN next_data.playlist_translations AS next_playlist_translations ON next_playlists.id = next_playlist_translations.playlist_id\nAND next_playlist_translations.locale = 'en'\nJOIN next_data.programs AS next_programs ON program_users.program_id = next_programs.id\nLEFT JOIN next_data.program_translations AS next_program_translation ON next_programs.id = next_program_translation.program_id\nAND next_program_translation.locale = 'en'\nLEFT JOIN next_data.responses AS next_responses ON next_users.id = next_responses.user_id\nLEFT JOIN next_data.question_translations AS next_question_translations ON next_responses.question_id = next_question_translations.question_id\nAND next_question_translations.locale = 'en'\nLEFT JOIN next_data.answer_translations AS next_answer_translations ON next_responses.answer_id = next_answer_translations.answer_id\nAND next_answer_translations.locale = 'en'\nWHERE 1 = 1\n  AND next_incentive_activities.completion IS NOT NULL\n  AND next_incentive_activities.status = 2", "SELECT organization_uuid\n     , UUID\nFROM adminifi_data.users"]}, "3f68e986-dc08-4c09-ae54-b40124f8b19a": {"datasource_id": "3f68e986-dc08-4c09-ae54-b40124f8b19a", "datasource_name": "atwork_activity", "source_table_names_list": ["ods.dim_atwork_playlists", "ods.dim_programs", "ods.dim_organizations", "ods.dim_incentives", "ods.dim_contents", "ods_static_data.dim_dates", "ods_static_data.dim_sourcesystems"], "source_field_names_list": ["dim_dates.year_of_week", "Extract.weekday_name", "sourcesystem_id (dim_contents)", "dim_programs.program_launch_at", "dim_organizations.organization_delete_date", "start_date", "Extract.organization_name", "dim_organizations.organization_industry", "content_slug", "Extract.incentive_key1", "dim_programs.program_delete_date", "Extract.incentive_created_at", "Extract.organization_salesforce_id", "Extract.sourcesystem_name", "Extract.day", "Extract.program_registrations", "dim_contents.content_isactive", "dim_incentives.incentive_complete_text", "playlist_slug", "dim_atwork_playlists.playlist_key", "Extract.sourcesystem_id4", "content_create_date", "Extract.playlist_slug", "dim_incentives.incentive_enabled_flag", "dim_incentives.incentive_created_at", "dim_contents.content_curriculum_id", "Extract.organization_uuid", "dim_incentives.incentive_key", "Extract.content_key1", "Extract.guest_users", "program_id", "dim_organizations.organization_benchmarks", "dim_contents.content_slug", "dim_programs.state", "dim_organizations.organization_id", "dim_sourcesystems.sourcesystem_id", "custom sql query.visit_internal_visit", "Extract.playlist_account_id", "Extract.module_page_views", "Extract.incentive_enabled_flag", "Extract.sourcesystem_id3", "Extract.playlist_create_date", "dim_incentives.organization_key", "city", "custom sql query.visits", "Extract.program_key1", "Extract.visit_region", "incentive_qualification_detail_link_click_visits", "dim_dates.month", "organization_contract_start_date", "[Calculated Field] Activity Completion Rate", "Extract.incentive_starts", "dim_incentives.incentive_id", "dim_organizations.organization_isdemo", "Extract.day_of_week", "Extract.week", "Extract.incentive_deleted_at", "dim_atwork_playlists.playlist_create_date", "custom sql query.date_key", "Extract.organization_company_size", "dim_incentives.playlist_id", "Extract.organization_isdemo", "organization_name", "Extract.quarter", "Extract.playlist_name1", "organization_institution_type", "dim_programs.sourcesystem_id", "program_create_date", "starts", "custom sql query.organization_key", "Extract.first_of_month", "visits", "year", "Extract.organization_logo_url", "Extract.sourcesystem_id2", "dim_dates.month_name", "playlist_tagline", "incentive_incomplete_url", "organization_id", "Extract.content_key", "dim_programs.audience_name", "Extract.organization_account_lead", "organization_account_lead", "program_update_date", "dim_programs.program_slug", "Extract.admins_sign_in_count", "content_type", "enrollments", "year_of_week", "program_name", "custom sql query.interstitial_page_views", "dim_incentives.sourcesystem_id", "Extract.program_key2", "[Calculated Field] Registered User Visit", "incentive_key (dim_incentives)", "first_of_month", "dim_organizations.organization_uuid", "dim_programs.program_type", "Extract.date", "Extract.incentive_detail_link_click_visits", "Extract.date_key", "custom sql query.no_user_visit", "sourcesystem_id (dim_organizations)", "playlist_key (dim_incentives)", "sourcesystem_id (dim_incentives)", "custom sql query.incentive_detail_link_clicks", "weekday_name", "Extract.active", "dim_contents.content_title", "dim_incentives.program_id", "[Calculated Field] Registered Users Created", "Extract.starts", "Extract.content_id", "parent_program_id", "custom sql query.module_page_views", "custom sql query.users_created", "Extract.start_date", "Extract.organization_asset_size_000", "dim_organizations.organization_account_lead", "dim_contents.content_update_date", "dim_dates.first_of_month", "incentive_complete_url", "Extract.date_key1", "Extract.organization_key1", "custom sql query.completions", "users_created", "month", "Extract.no_user_visit", "dim_atwork_playlists.playlist_update_date", "Guest Visits (copy)", "Extract.program_update_date", "Extract.parent_program_id", "Extract.organization_create_date", "Extract.playlist_key", "Extract.incentive_complete_text", "Extract.incentive_archived_flag", "playlist_key (dim_atwork_playlists)", "Extract.audience_id", "organization_company_size", "Extract.incentive_start_date", "dim_programs.city", "Extract.playlist_key1", "Extract.program_id1", "Extract.incentive_title1", "custom sql query.incentive_starts", "organization_industry", "dim_programs.program_id", "Extract.promotional_strategy_id", "dim_organizations.organization_create_date", "Extract.incentive_end_date", "incentive_title (dim_incentives)", "dim_sourcesystems.sourcesystem_name", "Extract.program_end_at", "custom sql query.incentive_qualification_detail_link_clicks", "dim_dates.day_of_week", "Extract.organization_industry", "[Calculated Field] Guest Visits", "Extract.content_type", "dim_incentives.incentive_title", "dim_programs.promotional_strategy_name", "[Calculated Field] Guest Users Created", "dim_organizations.organization_financial_institution_type", "dim_dates.date_key", "Extract.subsourcesystem_name1", "Extract.playlist_tagline", "program_key (dim_programs)", "Extract.subsourcesystem_name", "dim_atwork_playlists.playlist_description", "date", "custom sql query.sourcesystem_id", "dim_programs.program_key", "custom sql query.starts", "dim_incentives.incentive_incomplete_url", "Extract.program_type", "dim_incentives.incentive_incomplete_text", "dim_organizations.subsourcesystem_name", "dim_incentives.incentive_end_date", "incentive_deleted_at", "organization_isdemo", "dim_organizations.sourcesystem_id", "Extract.organization_benchmarks", "date_key (dim_dates)", "dim_programs.audience_id", "custom sql query.incentive_title", "custom sql query.visits_with_interstitial_page_views", "Registered User Visit (copy)", "state", "Extract.playlist_update_date", "custom sql query.enrollments", "[Calculated Field] No User Visit", "dim_organizations.organization_institution_type", "Extract.organization_salesforce_account_lead", "dim_organizations.last_admin_login_date", "dim_organizations.organization_contract_start_date", "Extract.interstitial_link_clicks", "custom sql query.visit_region", "sourcesystem_id (dim_atwork_playlists)", "Extract.visits_with_interstitial_link_clicks", "dim_organizations.organization_school_id", "Extract.program_delete_date", "month_name", "Extract.month_name", "incentive_start_date", "Extract.personalized_playlists", "Extract.incentive_qualification_detail_link_clicks", "content_update_date", "Extract.content_title", "Extract.enrollments", "dim_programs.promotional_strategy_id", "sourcesystem_name", "Extract.program_launch_at", "dim_incentives.incentive_archived_flag", "dim_atwork_playlists.playlist_id", "Extract.organization_id", "Extract.incentive_qualification_detail_link_click_visits", "dim_organizations.last_admin_login_name", "organization_logo_url", "dim_dates.quarter", "Extract.incentive_title", "dim_contents.content_type", "custom sql query.content_key", "Extract.year", "incentive_incomplete_text", "Extract.organization_financial_institution_type", "incentive_detail_link_click_visits", "content_curriculum_id", "organization_slug", "sourcesystem_id (dim_sourcesystems)", "dim_organizations.organization_logo_url", "Extract.state", "custom sql query.personalized_playlists", "dim_programs.parent_program_id", "program_slug", "Extract.program_create_date", "active", "organization_salesforce_id", "dim_organizations.organization_isactive", "custom sql query.bounced_visits", "dim_organizations.organization_aum_tier", "custom sql query.visits_with_interstitial_link_clicks", "Extract.audience_name", "content_key (dim_contents)", "dim_incentives.incentive_updated_at", "program_key (dim_incentives)", "dim_incentives.account_id", "Extract.program_slug", "guest_users", "Extract.program_key", "dim_organizations.admins_sign_in_count", "Extract.incentive_key", "Extract.organization_institution_type", "Extract.partner", "bounced_visits", "playlist_description", "organization_key (dim_incentives)", "custom sql query.partner", "custom sql query.playlist_key", "incentive_complete_text", "playlist_id", "Extract.bounced_visits", "Extract.organization_legacy_import_id", "dim_programs.program_name", "Extract.program_name", "dim_dates.day", "incentive_updated_at", "Extract.year_of_week", "program_type", "dim_contents.content_uuid", "Extract.sourcesystem_id", "playlist_create_date", "Extract.visits", "sourcesystem_id (dim_programs)", "dim_dates.week", "day", "organization_create_date", "Extract.interstitial_page_views", "incentive_end_date", "custom sql query.guest_users", "incentive_qualifications", "Extract.incentive_qualifications", "dim_programs.program_end_at", "Extract.completions", "Extract.sourcesystem_id1", "subsourcesystem_name (dim_contents)", "playlist_name (dim_atwork_playlists)", "Extract.last_admin_login_name", "dim_dates.year", "Extract.playlist_name", "content_isactive", "dim_organizations.organization_salesforce_id", "Extract.organization_cs_tier_score", "dim_contents.subsourcesystem_name", "dim_organizations.organization_cs_tier_score", "Extract.content_update_date", "playlist_account_id", "Extract.visit_internal_visit", "dim_contents.content_key", "organization_cs_tier_score", "organization_isactive", "Extract.incentive_updated_at", "custom sql query.incentive_qualifications", "Extract.incentive_incomplete_text", "organization_aum_tier", "organization_financial_institution_type", "Extract.playlist_id", "Extract.playlist_key2", "Extract.playlist_description", "Extract.content_slug", "custom sql query.incentive_qualification_detail_link_click_visits", "dim_incentives.program_key", "Extract.sourcesystem_id6", "organization_salesforce_account_lead", "program_id (dim_incentives)", "dim_contents.sourcesystem_id", "Extract.program_id", "dim_organizations.organization_salesforce_account_lead", "dim_programs.start_date", "dim_programs.program_update_date", "Extract.city", "Extract.incentive_id", "content_uuid", "dim_incentives.incentive_deleted_at", "Extract.organization_school_id", "dim_atwork_playlists.playlist_account_id", "custom sql query.incentive_detail_link_click_visits", "organization_asset_size_000", "Extract.incentive_complete_url", "dim_atwork_playlists.playlist_name", "dim_organizations.organization_slug", "dim_atwork_playlists.playlist_slug", "Extract.content_uuid", "account_id", "dim_incentives.playlist_key", "content_title", "organization_key (dim_organizations)", "dim_organizations.organization_asset_size_000", "incentive_id", "dim_programs.program_create_date", "Extract.organization_aum_tier", "Extract.organization_contract_start_date", "dim_programs.active", "dim_contents.content_create_date", "Extract.content_create_date", "Extract.visits_with_interstitial_page_views", "Extract.organization_slug", "dim_organizations.organization_name", "Extract.content_curriculum_id", "custom sql query.program_registrations", "organization_uuid", "quarter", "incentive_archived_flag", "custom sql query.program_key", "dim_atwork_playlists.sourcesystem_id", "dim_contents.content_id", "Extract.content_isactive", "playlist_id (dim_incentives)", "dim_incentives.incentive_complete_url", "custom sql query.playlist_name", "Extract.organization_key", "week", "Extract.playlist_id1", "content_id", "dim_organizations.organization_key", "incentive_created_at", "Extract.organization_key2", "playlist_update_date", "custom sql query.incentive_key", "program_registrations", "dim_organizations.organization_company_size", "completions", "Extract.organization_isactive", "incentive_enabled_flag", "day_of_week", "dim_atwork_playlists.playlist_tagline", "Extract.users_created", "dim_organizations.organization_legacy_import_id", "Extract.organization_delete_date", "Extract.incentive_detail_link_clicks", "Extract.incentive_incomplete_url", "dim_dates.weekday_name", "Extract.month", "Extract.promotional_strategy_name", "Extract.account_id", "Extract.last_admin_login_date", "custom sql query.interstitial_link_clicks", "Extract.sourcesystem_id5", "dim_incentives.incentive_start_date", "dim_dates.date"], "initial_sql": [], "custom_sql": ["WITH created_user AS\n  (SELECT next_users.id AS next_user_id\n   FROM next_data.users AS next_users\n   JOIN next_data.visits AS next_visits ON next_users.id = next_visits.user_id\n   JOIN next_data.events AS next_events ON next_visits.id = next_events.visit_id\n   WHERE next_visits.program_id IS NOT NULL\n     AND NVL(next_users.guest, FALSE) = TRUE\n   GROUP BY next_users.id\n   UNION SELECT next_users.id AS next_user_id\n   FROM next_data.users AS next_users\n   WHERE 1 = 1\n     AND NVL(next_users.guest, FALSE) = FALSE\n   GROUP BY next_users.id)\n   ,  USER_DATES_CTE AS\n  (SELECT next_users.id AS user_id\n        , 'user' AS date_type\n        , next_users.created_at::date AS user_date\n        , next_users.id::varchar AS record_type_id\n   FROM next_data.users AS next_users\n   UNION SELECT user_id\n              , date_type\n              , visit_started::date\n              , visit_id AS record_type_id\n   FROM\n     (SELECT next_users.id AS user_id\n           , 'visit' AS date_type\n           , next_visits.id AS visit_id\n           , next_visits.started_at AS visit_started\n           , DENSE_RANK() OVER(PARTITION BY next_users.id\n                               ORDER BY next_visits.started_at ASC) AS visit_rank\n      FROM next_data.users AS next_users\n      JOIN next_data.visits AS next_visits ON next_users.id = next_visits.user_id\n      WHERE 1 = 1\n        AND next_visits.program_id IS NOT NULL\n      GROUP BY next_users.id\n             , next_visits.id\n             , next_visits.started_at) name\n   WHERE visit_rank = 1\n   UNION SELECT user_id\n              , date_type\n              , event_time::date\n              , event_id AS record_type_id\n   FROM\n     (SELECT next_users.id AS user_id\n           , 'event' AS date_type\n           , next_events.id AS event_id\n           , next_events.time AS event_time\n           , DENSE_RANK() OVER(PARTITION BY next_users.id\n                               ORDER BY next_events.time ASC) AS event_rank\n      FROM next_data.users AS next_users\n      JOIN next_data.events AS next_events ON next_users.id = next_events.user_id\n      GROUP BY next_users.id\n             , next_events.id\n             , next_events.time) name\n   WHERE event_rank = 1)\n   , created_user_by_created_date AS\n  (SELECT created_user.next_user_id\n        , MAX(user_dates.user_date) AS user_created_date\n        , CASE\n              WHEN date_type = 'visit' THEN user_dates.record_type_id\n              ELSE NULL\n          END AS visit_id\n   FROM created_user\n   JOIN USER_DATES_CTE AS user_dates ON created_user.next_user_id = user_dates.user_id\n   LEFT JOIN next_data.visits AS next_visits ON CASE\n                                                    WHEN date_type = 'visit' THEN user_dates.record_type_id\n                                                    ELSE NULL\n                                                END = next_visits.id\n   GROUP BY created_user.next_user_id\n          , CASE\n                WHEN date_type = 'visit' THEN user_dates.record_type_id\n                ELSE NULL\n            END)\n   , PARTNER_CTE AS\n  (SELECT *\n        ,  CASE\n               WHEN organization_uuid IS NULL\n                    OR TRIM(organization_uuid) = '' THEN account_id::varchar || '-' ||\n                      (SELECT sourcesystem_name\n                       FROM ods_static_data.dim_sourcesystems\n                       WHERE sourcesystem_id = 3)\n               ELSE organization_uuid || '-' ||\n                      (SELECT sourcesystem_name\n                       FROM ods_static_data.dim_sourcesystems\n                       WHERE sourcesystem_id = 1)\n           END AS organization_key\n   FROM\n     (SELECT responses.user_id AS user_id\n           ,  account_questions.account_id\n           ,  account_questions.question_id\n           ,  responses.answer_id\n           ,  CASE\n                  WHEN responses.answer_id IS NULL THEN json_extract_path_text(responses.data, 'free_text')\n                  ELSE answer_translations.answer_text\n              END AS partner\n           ,  responses.created_at AS response_date\n           ,  responses.id AS response_id\n           ,  DENSE_RANK() OVER(PARTITION BY responses.user_id\n                                ORDER BY responses.created_at DESC) AS resp_rnk\n           ,  answer_translations.answer_text\n           ,  accounts.organization_uuid\n      FROM next_data.responses\n      JOIN next_data.account_questions ON account_questions.question_id = responses.question_id\n      JOIN next_data.accounts ON accounts.id = account_questions.account_id\n      LEFT JOIN next_data.answer_translations ON responses.answer_id = answer_translations.answer_id\n      AND answer_translations.locale = 'en'\n      WHERE account_questions.is_segment\n        AND account_questions.deleted_at IS NULL ) AS response_ranks\n   WHERE response_ranks.resp_rnk =1 )\n   , HR_CTE AS\n  (SELECT date.date_key AS activity_date\n        ,  org.organization_key\n        ,  prog.program_key\n        ,  COUNT(DISTINCT enrollments.id) AS program_enrolled\n        ,  0 AS module_started\n        ,  0 AS module_completed\n        ,  CASE\n               WHEN usrs.anonymous IS NULL THEN FALSE\n               ELSE TRUE\n           END AS user_guest_flag\n        ,  0 AS users_created\n        ,  4 AS sourcesystem_id\n   FROM homeroom_data.sponsors AS orgs\n   JOIN ods.dim_organizations AS org ON (org.organization_id = orgs.id || '-FinEd'\n                                         AND org.sourcesystem_id = 4)\n   OR (org.organization_UUId = orgs.uuid\n       AND org.sourcesystem_id = 1)\n   JOIN homeroom_data.sponsorships AS sponsorships ON orgs.id = sponsorships.sponsor_id\n   JOIN ods.dim_programs AS prog ON prog.program_key = CAST(sponsorships.school_id AS VARCHAR) || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 4)\n   JOIN homeroom_data.cohorts AS user_groups ON sponsorships.school_id = user_groups.school_id\n   AND sponsorships.curriculum_id = user_groups.curriculum_id\n   AND sponsorships.deleted_at IS NULL\n   AND user_groups.deleted_at IS NULL\n   JOIN homeroom_data.enrollments AS enrollments ON user_groups.id = enrollments.cohort_id\n   AND enrollments.deleted_at IS NULL\n   JOIN homeroom_data.users AS usrs ON enrollments.user_id = usrs.id\n   AND usrs.deleted_at IS NULL\n   JOIN ods_static_data.dim_dates date ON date.date = CAST(enrollments.created_at AS DATE)\n   WHERE sponsorships.curriculum_id = 2\n   GROUP BY org.organization_key\n          ,  prog.program_key\n          ,  date.date_key\n          ,  user_guest_flag\n   UNION ALL SELECT date.date_key AS activity_date\n                  ,  org.organization_key AS organization_key\n                  ,  prog.program_key\n                  ,  0 AS program_enrolled\n                  ,  COUNT(DISTINCT content_module_statuses.id) AS module_started\n                  ,  0 AS module_completed\n                  ,  CASE\n                         WHEN usrs.anonymous IS NULL THEN FALSE\n                         ELSE TRUE\n                     END AS user_guest_flag\n                  ,  0 AS users_created\n                  ,  4 AS sourcesystem_id\n   FROM homeroom_data.sponsors AS orgs\n   JOIN ods.dim_organizations AS org ON (org.organization_id = orgs.id || '-FinEd'\n                                         AND org.sourcesystem_id = 4)\n   OR (org.organization_UUId = orgs.uuid\n       AND org.sourcesystem_id = 1)\n   JOIN homeroom_data.sponsorships AS sponsorships ON orgs.id = sponsorships.sponsor_id\n   JOIN ods.dim_programs AS prog ON prog.program_key = CAST(sponsorships.school_id AS VARCHAR) || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 4)\n   JOIN homeroom_data.cohorts AS user_groups ON sponsorships.school_id = user_groups.school_id\n   AND sponsorships.curriculum_id = user_groups.curriculum_id\n   AND sponsorships.deleted_at IS NULL\n   AND user_groups.deleted_at IS NULL\n   JOIN homeroom_data.enrollments AS enrollments ON user_groups.id = enrollments.cohort_id\n   AND enrollments.deleted_at IS NULL\n   JOIN homeroom_data.users AS usrs ON enrollments.user_id = usrs.id\n   AND usrs.deleted_at IS NULL\n   JOIN homeroom_data.content_module_statuses content_module_statuses ON content_module_statuses.enrollment_id = enrollments.id\n   AND content_module_statuses.module_started_at IS NOT NULL\n   JOIN homeroom_data.content_modules content_modules ON content_modules.id = content_module_statuses.content_module_id\n   JOIN ods_static_data.dim_dates date ON date.date = CAST(content_module_statuses.module_started_at AS DATE)\n   JOIN homeroom_data.content_module_translations content_module_translations ON content_module_translations.content_module_id = content_modules.id\n   AND content_module_translations.locale = 'en'\n   WHERE sponsorships.curriculum_id = 2\n   GROUP BY org.organization_key\n          ,  prog.program_key\n          ,  date.date_key\n          ,  user_guest_flag\n   UNION ALL SELECT date.date_key AS activity_date\n                  ,  org.organization_key AS organization_key\n                  ,  prog.program_key\n                  ,  0 AS program_enrolled\n                  ,  0 AS module_started\n                  ,  COUNT(DISTINCT content_module_statuses.id) AS module_completed\n                  ,  CASE\n                         WHEN usrs.anonymous IS NULL THEN FALSE\n                         ELSE TRUE\n                     END AS user_guest_flag\n                  ,  0 AS users_created\n                  ,  4 AS sourcesystem_id\n   FROM homeroom_data.sponsors AS orgs\n   JOIN ods.dim_organizations AS org ON (org.organization_id = orgs.id || '-FinEd'\n                                         AND org.sourcesystem_id = 4)\n   OR (org.organization_UUId = orgs.uuid\n       AND org.sourcesystem_id = 1)\n   JOIN homeroom_data.sponsorships AS sponsorships ON orgs.id = sponsorships.sponsor_id\n   JOIN ods.dim_programs AS prog ON prog.program_key = CAST(sponsorships.school_id AS VARCHAR) || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 4)\n   JOIN homeroom_data.cohorts AS user_groups ON sponsorships.school_id = user_groups.school_id\n   AND sponsorships.curriculum_id = user_groups.curriculum_id\n   AND sponsorships.deleted_at IS NULL\n   AND user_groups.deleted_at IS NULL\n   JOIN homeroom_data.enrollments AS enrollments ON user_groups.id = enrollments.cohort_id\n   AND enrollments.deleted_at IS NULL\n   JOIN homeroom_data.users AS usrs ON enrollments.user_id = usrs.id\n   AND usrs.deleted_at IS NULL\n   JOIN homeroom_data.content_module_statuses content_module_statuses ON content_module_statuses.enrollment_id = enrollments.id\n   AND content_module_statuses.module_completed_at IS NOT NULL\n   JOIN homeroom_data.content_modules content_modules ON content_modules.id = content_module_statuses.content_module_id\n   JOIN ods_static_data.dim_dates date ON date.date = CAST(content_module_statuses.module_completed_at AS DATE)\n   JOIN homeroom_data.content_module_translations content_module_translations ON content_module_translations.content_module_id = content_modules.id\n   AND content_module_translations.locale = 'en'\n   WHERE sponsorships.curriculum_id = 2\n   GROUP BY org.organization_key\n          ,  prog.program_key\n          ,  date.date_key\n          ,  user_guest_flag\n   UNION ALL SELECT date.date_key AS activity_date\n                  ,  org.organization_key\n                  ,  prog.program_key\n                  ,  0 AS program_enrolled\n                  ,  0 AS module_started\n                  ,  0 AS module_completed\n                  ,  CASE\n                         WHEN usrs.anonymous IS NULL THEN FALSE\n                         ELSE TRUE\n                     END AS user_guest_flag\n                  ,  COUNT(DISTINCT usrs.id) AS users_created\n                  ,  4 AS sourcesystem_id\n   FROM homeroom_data.sponsors AS orgs\n   JOIN ods.dim_organizations AS org ON (org.organization_id = orgs.id || '-FinEd'\n                                         AND org.sourcesystem_id = 4)\n   OR (org.organization_UUId = orgs.uuid\n       AND org.sourcesystem_id = 1)\n   JOIN homeroom_data.sponsorships AS sponsorships ON orgs.id = sponsorships.sponsor_id\n   JOIN ods.dim_programs AS prog ON prog.program_key = CAST(sponsorships.school_id AS VARCHAR) || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 4)\n   JOIN homeroom_data.cohorts AS user_groups ON sponsorships.school_id = user_groups.school_id\n   AND sponsorships.curriculum_id = user_groups.curriculum_id\n   AND sponsorships.deleted_at IS NULL\n   AND user_groups.deleted_at IS NULL\n   JOIN homeroom_data.enrollments AS enrollments ON user_groups.id = enrollments.cohort_id\n   AND enrollments.deleted_at IS NULL\n   JOIN homeroom_data.users AS usrs ON enrollments.user_id = usrs.id\n   AND usrs.deleted_at IS NULL\n   JOIN ods_static_data.dim_dates date ON date.date = CAST(enrollments.created_at AS DATE)\n   WHERE sponsorships.curriculum_id = 2\n   GROUP BY org.organization_key\n          ,  prog.program_key\n          ,  date.date_key\n          ,  user_guest_flag) , NEXT_CTE AS\n  (SELECT COUNT(DISTINCT next_visits.id) AS visits\n        , COUNT(DISTINCT next_events.id) AS visit_events\n        , NVL(SUM(clickstream.interstitial_page_views), 0) AS interstitial_page_views\n        , COUNT(DISTINCT CASE\n                             WHEN clickstream.interstitial_page_views >> 0 THEN next_visits.id\n                             ELSE NULL\n                         END) AS visits_with_interstitial_page_views\n        , NVL(SUM(clickstream.interstitial_link_clicks), 0) AS interstitial_link_clicks\n        , COUNT(DISTINCT CASE\n                             WHEN clickstream.interstitial_link_clicks >> 0 THEN next_visits.id\n                             ELSE NULL\n                         END) AS visits_with_interstitial_link_clicks\n        , NVL(SUM(clickstream.page_views), 0) AS module_page_views\n        , COUNT(DISTINCT personalized_playlists.id) AS personalized_playlists\n        , 0 AS users_created\n        , NVL(COUNT(DISTINCT CASE\n                                 WHEN dim_visits.visit_bounced_flag THEN dim_visits.visit_id\n                                 ELSE NULL\n                             END)) AS bounced_visits\n        , 0 AS incentive_qualifications\n        , 0 AS incentive_starts\n        , 0 AS incentive_detail_link_clicks\n        , 0 AS incentive_detail_link_click_visits\n        , 0 AS incentive_qualification_detail_link_clicks\n        , 0 AS incentive_qualification_detail_link_click_visits\n        , 0 AS starts\n        , 0 AS completions\n        , 0 AS program_registrations\n        , CASE\n              WHEN next_users.id IS NULL THEN TRUE\n              ELSE FALSE\n          END AS no_user_visit\n        , NVL(next_users.guest, FALSE) AS guest_users\n        , next_visits.region AS visit_region\n        , PARTNER_CTE.partner AS partner\n        , dim_visits.internal_visit AS visit_internal_visit\n        , dates.date_key AS date_key\n        , CASE\n              WHEN next_accounts.organization_uuid IS NULL\n                   OR TRIM(next_accounts.organization_uuid) = '' THEN cast(next_accounts.id AS varchar) || '-' ||\n                     (SELECT sourcesystem_name\n                      FROM ods_static_data.dim_sourcesystems\n                      WHERE sourcesystem_id = 3)\n              ELSE next_accounts.organization_uuid || '-' ||\n                     (SELECT sourcesystem_name\n                      FROM ods_static_data.dim_sourcesystems\n                      WHERE sourcesystem_id = 1)\n          END AS organization_key\n        , next_programs.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3) AS program_key\n        , 'N/A' AS playlist_key\n        , 'N/A' AS playlist_name\n        , 'N/A' AS incentive_key\n        , 'N/A' AS incentive_title\n        , 'N/A' AS content_key\n        , 3 AS sourcesystem_id\n   FROM next_data.visits AS next_visits\n   LEFT JOIN ods.dim_atwork_visits AS dim_visits ON next_visits.id = dim_visits.visit_id\n   JOIN ods_static_data.dim_dates AS dates ON dates.date = CAST(next_visits.started_at AS DATE)\n   JOIN next_data.accounts AS next_accounts ON next_visits.account_id = next_accounts.id\n   JOIN next_data.programs AS next_programs ON next_visits.program_id = next_programs.id\n   AND next_visits.account_id = next_programs.account_id\n   LEFT JOIN next_data.program_translations AS next_program_translations ON next_programs.id = next_program_translations.program_id\n   AND next_program_translations.locale = 'en'\n   LEFT JOIN\n     (SELECT SUM(interstitial_page_views) AS interstitial_page_views\n           , SUM(interstitial_link_clicks) AS interstitial_link_clicks\n           , SUM(pages_count) AS page_views\n           , visit_key\n      FROM ods.fact_atwork_module_clickstream_activities\n      GROUP BY visit_key ) AS clickstream ON cast(next_visits.id AS varchar) || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3) = clickstream.visit_key\n   AND (clickstream.interstitial_link_clicks >> 0\n        OR clickstream.interstitial_page_views >> 0)\n   LEFT JOIN next_data.users AS next_users ON next_visits.user_id = next_users.id\n   LEFT JOIN next_data.personalized_playlists ON personalized_playlists.user_id = next_users.id\n   LEFT JOIN next_data.events AS next_events ON next_visits.id = next_events.visit_id\n   LEFT JOIN PARTNER_CTE AS partner_cte ON next_visits.user_id = partner_cte.user_id\n   WHERE 1 = 1\n   GROUP BY dates.date_key\n          , CASE\n                WHEN next_accounts.organization_uuid IS NULL\n                     OR TRIM(next_accounts.organization_uuid) = '' THEN cast(next_accounts.id AS varchar) || '-' ||\n                       (SELECT sourcesystem_name\n                        FROM ods_static_data.dim_sourcesystems\n                        WHERE sourcesystem_id = 3)\n                ELSE next_accounts.organization_uuid || '-' ||\n                       (SELECT sourcesystem_name\n                        FROM ods_static_data.dim_sourcesystems\n                        WHERE sourcesystem_id = 1)\n            END\n          , next_programs.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3)\n          , CASE\n                WHEN next_users.id IS NULL THEN TRUE\n                ELSE FALSE\n            END\n          , NVL(next_users.guest, FALSE)\n          , next_visits.region\n          , dim_visits.internal_visit\n          , partner_cte.partner\n   UNION SELECT 0 AS visits\n              , 0 AS visit_events\n              , 0 AS interstitial_page_views\n              , 0 AS visits_with_interstitial_page_views\n              , 0 AS interstitial_link_clicks\n              , 0 AS visits_with_interstitial_link_clicks\n              , 0 AS module_page_views\n              , 0 AS personalized_playlists\n              , COUNT(DISTINCT next_users.id) AS users_created\n              , 0 AS bounced_visits\n              , 0 AS incentive_qualifications\n              , 0 AS incentive_starts\n              , 0 AS incentive_detail_link_clicks\n              , 0 AS incentive_detail_link_click_visits\n              , 0 AS incentive_qualification_detail_link_clicks\n              , 0 AS incentive_qualification_detail_link_click_visits\n              , 0 AS starts\n              , 0 AS completed\n              , 0 AS program_registrations\n              , NULL AS no_user_visit\n              , NVL(next_users.guest, FALSE) AS guest_users\n              , 'N/A' AS visit_region\n              , PARTNER_CTE.partner AS partner\n              , FALSE AS visit_internal_visit\n                       , dates.date_key AS date_key\n                       , CASE\n                             WHEN next_accounts.organization_uuid IS NULL\n                                  OR TRIM(next_accounts.organization_uuid) = '' THEN cast(next_accounts.id AS varchar) || '-' ||\n                                    (SELECT sourcesystem_name\n                                     FROM ods_static_data.dim_sourcesystems\n                                     WHERE sourcesystem_id = 3)\n                             ELSE next_accounts.organization_uuid || '-' ||\n                                    (SELECT sourcesystem_name\n                                     FROM ods_static_data.dim_sourcesystems\n                                     WHERE sourcesystem_id = 1)\n                         END AS organization_key\n                       , next_visits.program_id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3) AS program_key\n                       , 'N/A' AS playlist_key\n                       , 'N/A' AS playlist_name\n                       , 'N/A' AS incentive_key\n                       , 'N/A' AS incentive_title\n                       , 'N/A' AS content_key\n                       , 3 AS sourcesystem_id\n   FROM next_data.users AS next_users\n   LEFT JOIN PARTNER_CTE ON PARTNER_CTE.user_id = next_users.id\n   JOIN created_user_by_created_date AS created_user ON next_users.id = created_user.next_user_id\n   JOIN next_data.accounts AS next_accounts ON next_users.account_id = next_accounts.id\n   JOIN ods_static_data.dim_dates AS dates ON dates.date = CAST(created_user.user_created_date AS DATE)\n   JOIN next_data.visits AS next_visits ON created_user.visit_id = next_visits.id\n   WHERE 1 = 1\n     AND next_visits.program_id IS NOT NULL\n   GROUP BY dates.date_key\n          , NVL(next_users.guest, FALSE)\n          , CASE\n                WHEN next_accounts.organization_uuid IS NULL\n                     OR TRIM(next_accounts.organization_uuid) = '' THEN cast(next_accounts.id AS varchar) || '-' ||\n                       (SELECT sourcesystem_name\n                        FROM ods_static_data.dim_sourcesystems\n                        WHERE sourcesystem_id = 3)\n                ELSE next_accounts.organization_uuid || '-' ||\n                       (SELECT sourcesystem_name\n                        FROM ods_static_data.dim_sourcesystems\n                        WHERE sourcesystem_id = 1)\n            END\n          , next_visits.program_id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3)\n          , PARTNER_CTE.partner\n   UNION SELECT 0 AS visits\n              , 0 AS visit_events\n              , 0 AS interstitial_page_views\n              , 0 AS visits_with_interstitial_page_views\n              , 0 AS interstitial_link_clicks\n              , 0 AS visits_with_interstitial_link_clicks\n              , 0 AS module_page_views\n              , 0 AS personalized_playlists\n              , 0 AS users_created\n              , 0 AS bounced_visits\n              , 0 AS incentive_qualifications\n              , 0 AS incentive_starts\n              , 0 AS incentive_detail_link_clicks\n              , 0 AS incentive_detail_link_click_visits\n              , 0 AS incentive_qualification_detail_link_clicks\n              , 0 AS incentive_qualification_detail_link_click_visits\n              , COUNT(DISTINCT user_content.id) AS starts\n              , COUNT(DISTINCT CASE\n                                   WHEN user_content.state = 3 THEN user_content.id\n                                   ELSE NULL\n                               END) AS completed\n              , 0 AS program_registrations\n              , NULL AS no_user_visit\n              , NVL(next_users.guest, FALSE) AS guest_users\n              , 'N/A' AS visit_region\n              , PARTNER_CTE.partner AS partner\n              , FALSE AS visit_internal_visit\n                       , dates.date_key AS date_key\n                       , CASE\n                             WHEN accounts.organization_uuid IS NULL\n                                  OR TRIM(accounts.organization_uuid) = '' THEN cast(accounts.id AS varchar) || '-' ||\n                                    (SELECT sourcesystem_name\n                                     FROM ods_static_data.dim_sourcesystems\n                                     WHERE sourcesystem_id = 3)\n                             ELSE accounts.organization_uuid || '-' ||\n                                    (SELECT sourcesystem_name\n                                     FROM ods_static_data.dim_sourcesystems\n                                     WHERE sourcesystem_id = 1)\n                         END AS organization_key\n                       , next_programs.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3) AS program_key\n                       , 'N/A' AS playlist_key\n                       , 'N/A' AS playlist_name\n                       , 'N/A' AS incentive_key\n                       , 'N/A' AS incentive_title\n                       , content.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3) AS content_key\n                       , 3 AS sourcesystem_id\n   FROM next_data.users AS next_users\n   LEFT JOIN partner_cte ON partner_cte.user_id = next_users.id\n   JOIN created_user_by_created_date AS valid_user ON next_users.id = valid_user.next_user_id\n   JOIN next_data.accounts AS accounts ON next_users.account_id = accounts.id\n   JOIN next_data.programs AS next_programs ON accounts.id = next_programs.account_id\n   JOIN next_data.program_users AS next_program_users ON next_users.id = next_program_users.user_id\n   AND next_programs.id = next_program_users.program_id\n   JOIN next_data.user_content AS user_content ON next_users.id = user_content.user_id\n   JOIN ods_static_data.dim_dates AS dates ON dates.date = CAST(user_content.started_at AS DATE)\n   JOIN next_data.content AS content ON user_content.content_id = content.id\n   JOIN next_data.content_translations ON content_translations.content_id = user_content.content_id\n   AND content_translations.locale = 'en'\n   WHERE 1 = 1\n     AND user_content.state in (1\n                              , 2\n                              , 3)\n     AND content.type NOT IN ('calculator'\n                            , 'assessment')\n   GROUP BY NVL(next_users.guest, FALSE)\n          , dates.date_key\n          , CASE\n                WHEN accounts.organization_uuid IS NULL\n                     OR TRIM(accounts.organization_uuid) = '' THEN cast(accounts.id AS varchar) || '-' ||\n                       (SELECT sourcesystem_name\n                        FROM ods_static_data.dim_sourcesystems\n                        WHERE sourcesystem_id = 3)\n                ELSE accounts.organization_uuid || '-' ||\n                       (SELECT sourcesystem_name\n                        FROM ods_static_data.dim_sourcesystems\n                        WHERE sourcesystem_id = 1)\n            END\n          , next_programs.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3)\n          , content.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3)\n          , PARTNER_CTE.partner\n   UNION SELECT 0 AS visits\n              , 0 AS visit_events\n              , 0 AS interstitial_page_views\n              , 0 AS visits_with_interstitial_page_views\n              , 0 AS interstitial_link_clicks\n              , 0 AS visits_with_interstitial_link_clicks\n              , 0 AS module_page_views\n              , 0 AS personalized_playlists\n              , 0 AS users_created\n              , 0 AS bounced_visits\n              , 0 AS incentive_qualifications\n              , 0 AS incentive_starts\n              , 0 AS incentive_detail_link_clicks\n              , 0 AS incentive_detail_link_click_visits\n              , 0 AS incentive_qualification_detail_link_clicks\n              , 0 AS incentive_qualification_detail_link_click_visits\n              , COUNT(DISTINCT user_content.id) AS starts\n              , COUNT(DISTINCT CASE\n                                   WHEN user_content.state = 3 THEN user_content.id\n                                   ELSE NULL\n                               END) AS completed\n              , 0 AS program_registrations\n              , NULL AS no_user_visit\n              , NVL(next_users.guest, FALSE) AS guest_users\n              , 'N/A' AS visit_region\n              , PARTNER_CTE.partner AS partner\n              , FALSE AS visit_internal_visit\n                       , dates.date_key AS date_key\n                       , CASE\n                             WHEN accounts.organization_uuid IS NULL\n                                  OR TRIM(accounts.organization_uuid) = '' THEN cast(accounts.id AS varchar) || '-' ||\n                                    (SELECT sourcesystem_name\n                                     FROM ods_static_data.dim_sourcesystems\n                                     WHERE sourcesystem_id = 3)\n                             ELSE accounts.organization_uuid || '-' ||\n                                    (SELECT sourcesystem_name\n                                     FROM ods_static_data.dim_sourcesystems\n                                     WHERE sourcesystem_id = 1)\n                         END AS organization_key\n                       , next_programs.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3) AS program_key\n                       , 'N/A' AS playlist_key\n                       , 'N/A' AS playlist_name\n                       , 'N/A' AS incentive_key\n                       , 'N/A' AS incentive_title\n                       , content.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3) AS contents_key\n                       , 3 AS sourcesystem_id\n   FROM next_data.users AS next_users\n   LEFT JOIN PARTNER_CTE ON PARTNER_CTE.user_id = next_users.id\n   JOIN created_user_by_created_date AS valid_user ON next_users.id = valid_user.next_user_id\n   JOIN next_data.accounts AS accounts ON next_users.account_id = accounts.id\n   JOIN next_data.programs AS next_programs ON accounts.id = next_programs.account_id\n   JOIN next_data.program_users AS next_program_users ON next_users.id = next_program_users.user_id\n   AND next_programs.id = next_program_users.program_id\n   JOIN next_data.user_content AS user_content ON next_users.id = user_content.user_id\n   LEFT JOIN next_data.content_translations content_translations ON content_translations.content_id = user_content.content_id\n   AND content_translations.locale = 'en'\n   JOIN next_data.content ON content.id = user_content.content_id\n   JOIN ods_static_data.dim_dates AS dates ON dates.date = CAST(user_content.completed_at AS DATE)\n   WHERE 1 = 1\n     AND user_content.state in (3)\n     AND content.type = 'calculator'\n   GROUP BY NVL(next_users.guest, FALSE)\n          , dates.date_key\n          , CASE\n                WHEN accounts.organization_uuid IS NULL\n                     OR TRIM(accounts.organization_uuid) = '' THEN cast(accounts.id AS varchar) || '-' ||\n                       (SELECT sourcesystem_name\n                        FROM ods_static_data.dim_sourcesystems\n                        WHERE sourcesystem_id = 3)\n                ELSE accounts.organization_uuid || '-' ||\n                       (SELECT sourcesystem_name\n                        FROM ods_static_data.dim_sourcesystems\n                        WHERE sourcesystem_id = 1)\n            END\n          , next_programs.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3)\n          , content.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3)\n          , PARTNER_CTE.partner\n   UNION SELECT 0 AS visits\n              , 0 AS visit_events\n              , 0 AS interstitial_page_views\n              , 0 AS visits_with_interstitial_page_views\n              , 0 AS interstitial_link_clicks\n              , 0 AS visits_with_interstitial_link_clicks\n              , 0 AS module_page_views\n              , 0 AS personalized_playlists\n              , 0 AS users_created\n              , 0 AS bounced_visits\n              , COUNT(DISTINCT next_incentive_activities.id) AS incentive_qualifications\n              , 0 AS incentive_starts\n              , 0 AS incentive_detail_link_clicks\n              , 0 AS incentive_detail_link_click_visits\n              , 0 AS incentive_qualification_detail_link_clicks\n              , 0 AS incentive_qualification_detail_link_click_visits\n              , 0 AS starts\n              , 0 AS completed\n              , 0 AS program_registrations\n              , NULL AS no_user_visit\n              , NVL(next_users.guest, FALSE) AS guest_users\n              , 'N/A' AS visit_region\n              , PARTNER_CTE.partner AS partner\n              , FALSE AS visit_internal_visit\n                       , dim_dates.date_key AS date_key\n                       , CASE\n                             WHEN next_accounts.organization_uuid IS NULL\n                                  OR TRIM(next_accounts.organization_uuid) = '' THEN cast(next_accounts.id AS varchar) || '-' ||\n                                    (SELECT sourcesystem_name\n                                     FROM ods_static_data.dim_sourcesystems\n                                     WHERE sourcesystem_id = 3)\n                             ELSE next_accounts.organization_uuid || '-' ||\n                                    (SELECT sourcesystem_name\n                                     FROM ods_static_data.dim_sourcesystems\n                                     WHERE sourcesystem_id = 1)\n                         END AS organization_key\n                       , next_incentives.program_id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3)\n                       , next_incentives.playlist_id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3)\n                       , next_playlist_translations.name AS playlist_name\n                       , next_incentives.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3) AS incentive_key\n                       , next_incentive_translations.title AS incentive_title\n                       , 'N/A' AS content_key\n                       , 3 AS sourcesystem_id\n   FROM next_data.incentives AS next_incentives\n   JOIN next_data.incentive_translations AS next_incentive_translations ON next_incentives.id = next_incentive_translations.incentive_id\n   AND next_incentive_translations.locale = 'en'\n   JOIN next_data.incentive_activities AS next_incentive_activities ON next_incentives.id = next_incentive_activities.incentive_id\n   AND next_incentive_activities.status = 2\n   JOIN next_data.program_users ON program_users.program_id = next_incentives.program_id\n   AND program_users.user_id = next_incentive_activities.user_id\n   JOIN ods_static_data.dim_dates AS dim_dates ON next_incentive_activities.completion::date = dim_dates.date\n   JOIN next_data.users AS next_users ON next_incentive_activities.user_id = next_users.id\n   LEFT JOIN PARTNER_CTE ON PARTNER_CTE.user_id = next_users.id\n   JOIN created_user_by_created_date AS created_users ON next_users.id = created_users.next_user_id\n   LEFT JOIN adminifi_data.users AS adminifi_users ON next_users.foundry_id = adminifi_users.uuid\n   JOIN next_data.accounts AS next_accounts ON next_users.account_id = next_accounts.id\n   LEFT JOIN next_data.account_translations AS next_account_translations ON next_accounts.id = next_account_translations.account_id\n   AND next_account_translations.locale = 'en'\n   JOIN next_data.playlists AS next_playlists ON next_incentives.playlist_id = next_playlists.id\n   LEFT JOIN next_data.playlist_translations AS next_playlist_translations ON next_playlists.id = next_playlist_translations.playlist_id\n   AND next_playlist_translations.locale = 'en'\n   JOIN next_data.programs AS next_programs ON next_incentives.program_id = next_programs.id\n   LEFT JOIN next_data.program_translations AS next_program_translation ON next_programs.id = next_program_translation.program_id\n   AND next_program_translation.locale = 'en'\n   WHERE 1 = 1\n     AND next_incentive_activities.completion IS NOT NULL\n     AND next_incentive_activities.status = 2\n   GROUP BY dim_dates.date_key\n          , CASE\n                WHEN next_accounts.organization_uuid IS NULL\n                     OR TRIM(next_accounts.organization_uuid) = '' THEN cast(next_accounts.id AS varchar) || '-' ||\n                       (SELECT sourcesystem_name\n                        FROM ods_static_data.dim_sourcesystems\n                        WHERE sourcesystem_id = 3)\n                ELSE next_accounts.organization_uuid || '-' ||\n                       (SELECT sourcesystem_name\n                        FROM ods_static_data.dim_sourcesystems\n                        WHERE sourcesystem_id = 1)\n            END\n          , next_incentives.program_id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3)\n          , next_incentives.playlist_id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3)\n          , next_playlist_translations.name\n          , next_incentives.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3)\n          , next_incentive_translations.title\n          , PARTNER_CTE.partner\n          , NVL(next_users.guest, FALSE)\n   UNION SELECT 0 AS visits\n              , 0 AS visit_events\n              , 0 AS interstitial_page_views\n              , 0 AS visits_with_interstitial_page_views\n              , 0 AS interstitial_link_clicks\n              , 0 AS visits_with_interstitial_link_clicks\n              , 0 AS module_page_views\n              , 0 AS personalized_playlists\n              , 0 AS users_created\n              , 0 AS bounced_visits\n              , 0 AS incentive_qualifications\n              , 0 AS incentive_starts\n              , 0 AS incentive_detail_link_clicks\n              , 0 AS incentive_detail_link_click_visits\n              , 0 AS incentive_qualification_detail_link_clicks\n              , 0 AS incentive_qualification_detail_link_click_visits\n              , 0 AS starts\n              , 0 AS completed\n              , COUNT(DISTINCT next_program_users.id) AS program_registrations\n              , NULL AS no_user_visit\n              , NVL(next_users.guest, FALSE) AS guest_users\n              , 'N/A' AS visit_region\n              , PARTNER_CTE.partner AS partner\n              , FALSE AS visit_internal_visit\n                       , dates.date_key AS date_key\n                       , CASE\n                             WHEN accounts.organization_uuid IS NULL\n                                  OR TRIM(accounts.organization_uuid) = '' THEN cast(accounts.id AS varchar) || '-' ||\n                                    (SELECT sourcesystem_name\n                                     FROM ods_static_data.dim_sourcesystems\n                                     WHERE sourcesystem_id = 3)\n                             ELSE accounts.organization_uuid || '-' ||\n                                    (SELECT sourcesystem_name\n                                     FROM ods_static_data.dim_sourcesystems\n                                     WHERE sourcesystem_id = 1)\n                         END AS organization_key\n                       , next_programs.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3) AS program_key\n                       , 'N/A' AS playlist_key\n                       , 'N/A' AS playlist_name\n                       , 'N/A' AS incentive_key\n                       , 'N/A' AS incentive_title\n                       , 'N/A' AS content_key\n                       , 3 AS sourcesystem_id\n   FROM next_data.program_users AS next_program_users\n   LEFT JOIN PARTNER_CTE ON PARTNER_CTE.user_id = next_program_users.user_id\n   JOIN next_data.users AS next_users ON next_program_users.user_id = next_users.id\n   JOIN next_data.accounts AS accounts ON next_users.account_id = accounts.id\n   JOIN next_data.programs AS next_programs ON next_programs.id = next_program_users.program_id\n   JOIN ods_static_data.dim_dates AS dates ON dates.date = next_program_users.created_at::date\n   WHERE 1 = 1\n     AND next_programs.deleted_at IS NULL\n   GROUP BY NVL(next_users.guest, FALSE)\n          , dates.date_key\n          , CASE\n                WHEN accounts.organization_uuid IS NULL\n                     OR TRIM(accounts.organization_uuid) = '' THEN cast(accounts.id AS varchar) || '-' ||\n                       (SELECT sourcesystem_name\n                        FROM ods_static_data.dim_sourcesystems\n                        WHERE sourcesystem_id = 3)\n                ELSE accounts.organization_uuid || '-' ||\n                       (SELECT sourcesystem_name\n                        FROM ods_static_data.dim_sourcesystems\n                        WHERE sourcesystem_id = 1)\n            END\n          , next_programs.id || '-' ||\n     (SELECT sourcesystem_name\n      FROM ods_static_data.dim_sourcesystems\n      WHERE sourcesystem_id = 3)\n          , PARTNER_CTE.partner)\nSELECT date_key\n     ,  organization_key\n     ,  program_key\n     ,  no_user_visit\n     ,  guest_users\n     ,  sourcesystem_id\n     ,  playlist_key\n     ,  playlist_name\n     ,  incentive_key\n     ,  incentive_title\n     ,  0 AS enrollments\n     ,  content_key\n     ,  visit_region\n     ,  partner\n     ,  visit_internal_visit\n     ,  SUM(visits) AS visits\n     ,  SUM(interstitial_page_views) AS interstitial_page_views\n     ,  SUM(visits_with_interstitial_page_views) AS visits_with_interstitial_page_views\n     ,  SUM(interstitial_link_clicks) AS interstitial_link_clicks\n     ,  SUM(visits_with_interstitial_link_clicks) AS visits_with_interstitial_link_clicks\n     ,  SUM(module_page_views) AS module_page_views\n     ,  SUM(personalized_playlists) AS personalized_playlists\n     ,  SUM(incentive_qualifications) AS incentive_qualifications\n     ,  SUM(incentive_starts) AS incentive_starts\n     ,  SUM(incentive_detail_link_clicks) AS incentive_detail_link_clicks\n     ,  SUM(incentive_detail_link_click_visits) AS incentive_detail_link_click_visits\n     ,  SUM(incentive_qualification_detail_link_clicks) AS incentive_qualification_detail_link_clicks\n     ,  SUM(incentive_qualification_detail_link_click_visits) AS incentive_qualification_detail_link_click_visits\n     ,  SUM(bounced_visits) AS bounced_visits\n     ,  SUM(starts) AS starts\n     ,  SUM(completions) AS completions\n     ,  SUM(program_registrations) AS program_registrations\n     ,  SUM(users_created) AS users_created\nFROM NEXT_CTE\nGROUP BY date_key\n       ,  organization_key\n       ,  program_key\n       ,  no_user_visit\n       ,  guest_users\n       ,  sourcesystem_id\n       ,  playlist_key\n       ,  playlist_name\n       ,  incentive_key\n       ,  incentive_title\n       ,  content_key\n       ,  visit_region\n       ,  partner\n       ,  visit_internal_visit\nUNION ALL\nSELECT activity_date AS activity_date_key\n     ,  organization_key\n     ,  program_key\n     ,  FALSE\n     ,  user_guest_flag\n     ,  sourcesystem_id\n     ,  'N/A' AS playlist_key\n     ,  'N/A' AS playlist_name\n     ,  'N/A' AS incentive_key\n     ,  'N/A' AS incentive_title\n     ,  SUM(program_enrolled) AS program_enrolled\n     ,  'N/A' AS content_key\n     ,  'N/A' AS visit_region\n     ,  'N/A' AS partner\n     ,  FALSE AS visit_internal_visit\n               ,  0 AS Visits\n               ,  0 AS interstitial_page_views\n               ,  0 AS visits_with_interstitial_page_views\n               ,  0 AS interstitial_link_clicks\n               ,  0 AS visits_with_interstitial_link_clicks\n               ,  0 AS module_page_views\n               ,  0 AS personalized_playlists\n               ,  0 AS incentive_qualifications\n               ,  0 AS incentive_starts\n               ,  0 AS incentive_detail_link_clicks\n               ,  0 AS incentive_detail_link_click_visits\n               ,  0 AS incentive_qualification_detail_link_clicks\n               ,  0 AS incentive_qualification_detail_link_click_visits\n               ,  0 AS bounced_visits\n               ,  SUM(module_started) AS module_started\n               ,  SUM(module_completed) AS module_completed\n               ,  0 AS program_registrations\n               ,  SUM(users_created) AS users_created\nFROM HR_CTE\nGROUP BY activity_date\n       ,  organization_key\n       ,  program_key\n       ,  user_guest_flag\n       ,  sourcesystem_id"]}, "345806dc-a1a4-447f-8c32-8ee05d2ebf3a": {"datasource_id": "345806dc-a1a4-447f-8c32-8ee05d2ebf3a", "datasource_name": "Tableau Admin - Postman Reference", "source_table_names_list": ["public.groups", "public.workbooks", "public.sites", "public.projects"], "source_field_names_list": ["groups.domain_id", "site_id", "notification_enabled", "site_id (workbooks)", "sheet_image_enabled", "groups.last_synchronized", "projects.controlled_permissions_enabled", "projects.owner_id", "refreshable_extracts", "extracts_incremented_at", "share_description", "created_at (projects)", "sites.allow_live_query_sync", "content_version", "name (groups)", "allow_live_query_sync", "sites.luid", "size", "version_history_enabled", "owner_id (groups)", "extracts_refreshed_at", "projects.id", "projects.name", "workbooks.primary_content_url", "sites.version_history_enabled", "sites.storage_quota", "sites.refresh_token_setting", "workbooks.id", "sites.created_at", "content_version_limit", "data_alerts_enabled", "sites.data_alerts_enabled", "workbooks.incrementable_extracts", "updated_at", "checksum", "projects.state", "minimum_site_role", "luid (projects)", "workbooks.refreshable_extracts", "special", "groups.owner_id", "description (workbooks)", "revision", "workbooks.revision", "sites.notification_enabled", "owner_id (workbooks)", "query_limit", "sites.cache_warmup_enabled", "groups.updated_at", "sites.tier_author_capacity", "sites.protocol_group_size_limit", "name", "groups.id", "workbooks.view_count", "sites.authoring_disabled", "groups.name", "sites.lock_version", "workbooks.reduced_data_id", "last_published_at", "project_id", "version", "custom_subscription_email", "data_engine_extracts", "sites.subscribe_others_enabled", "sites.custom_subscription_email", "sites.user_quota", "luid (groups)", "sites.tier_basic_user_capacity", "controlled_permissions_enabled", "status", "last_synchronized", "workbooks.content_version", "workbooks.repository_data_id", "workbooks.owner_id", "sites.cache_warmup_threshold", "created_at", "sites.status", "workbooks.name", "sites.name", "groups.system", "sites.commenting_enabled", "id", "workbooks.created_at", "sites.id", "sites.viz_in_tooltip_enabled", "luid", "sites.guest_access_enabled", "created_at (groups)", "workbooks.data_engine_extracts", "document_version", "workbooks.updated_at", "storage_quota", "workbooks.project_id", "system", "workbooks.default_view_index", "sites.url_namespace", "cache_warmup_threshold", "workbooks.repository_url", "updated_at (projects)", "workbooks.luid", "site_id (groups)", "workbooks.first_published_at", "workbooks.share_description", "repository_data_id", "projects.updated_at", "sites.updated_at", "url_namespace", "groups.minimum_site_role", "workbooks.thumb_user", "name (workbooks)", "lock_version (workbooks)", "commenting_enabled", "subscriptions_enabled", "thumb_user", "[Calculated Field] empty", "workbooks.description", "workbooks.checksum", "workbooks.version", "id (groups)", "projects.parent_project_id", "reduced_data_id", "workbooks.data_id", "luid (workbooks)", "sites.self_service_schedules_enabled", "incrementable_extracts", "show_toolbar", "id (projects)", "self_service_schedules_enabled", "workbooks.site_id", "projects.created_at", "default_view_index", "lock_version", "workbooks.extracts_incremented_at", "embedded", "projects.luid", "primary_content_url", "state (workbooks)", "workbooks.document_version", "asset_key_id", "custom_subscription_footer", "metrics_level", "owner_id", "workbooks.lock_version", "repository_url", "updated_at (groups)", "first_published_at", "sites.subscriptions_enabled", "support_access_enabled", "workbooks.last_published_at", "sites.query_limit", "updated_at (workbooks)", "sites.sheet_image_enabled", "name (projects)", "sites.custom_subscription_footer", "workbooks.display_tabs", "parent_project_id", "content_admin_mode", "domain_id", "projects.special", "workbooks.size", "sites.status_reason", "groups.site_id", "guest_access_enabled", "authoring_disabled", "workbooks.show_toolbar", "status_reason", "workbooks.state", "created_at (workbooks)", "workbooks.embedded", "data_alerts_check_frequency", "groups.created_at", "sites.tier_interactor_capacity", "projects.site_id", "sites.content_version_limit", "sites.metrics_level", "id (workbooks)", "user_quota", "sites.support_access_enabled", "display_tabs", "sites.content_admin_mode", "state", "subscribe_others_enabled", "workbooks.extracts_refreshed_at", "published_all_sheets", "groups.luid", "refresh_token_setting", "repository_extract_data_id", "data_id", "workbooks.asset_key_id", "description", "projects.description", "sites.protocol_cache_lifetime", "workbooks.repository_extract_data_id", "cache_warmup_enabled", "workbooks.published_all_sheets", "view_count"], "initial_sql": [], "custom_sql": []}, "5c47de26-4c28-447b-976c-40889ec94023": {"datasource_id": "5c47de26-4c28-447b-976c-40889ec94023", "datasource_name": "atwork-poll-response-activity", "source_table_names_list": ["ods.fact_atwork_program_poll_response_activity", "ods.dim_programs", "ods.dim_organizations", "ods.dim_contents", "ods_static_data.dim_dates", "ods.dim_polls", "ods_static_data.dim_sourcesystems"], "source_field_names_list": ["Extract.date_key", "Extract.poll_poll_key", "sourcesystem_id (dim_organizations)", "dim_contents.subsourcesystem_name", "dim_organizations.organization_contract_start_date", "dim_organizations.organization_cs_tier_score", "Extract.content_update_date", "answer_count", "Extract.poll_id", "Extract.weekday_name", "sourcesystem_id (dim_contents)", "dim_contents.content_key", "organization_cs_tier_score", "program_end_at", "dim_programs.program_launch_at", "dim_organizations.organization_delete_date", "sourcesystem_id", "start_date", "organization_isactive", "weekday_name", "Extract.organization_name", "dim_organizations.organization_school_id", "Extract.program_delete_date", "Extract.organization_cs_tier_score", "Extract.poll_create_date", "dim_polls.poll_poll_key", "Extract.active", "dim_organizations.organization_industry", "Extract.month_name", "Extract.poll_key1", "dim_contents.content_title", "month_name", "dim_polls.poll_key", "content_slug", "organization_aum_tier", "organization_financial_institution_type", "fact_atwork_program_poll_response_activity.program_key", "user_response", "promotional_strategy_id", "dim_programs.program_delete_date", "Extract.organization_salesforce_id", "Extract.sourcesystem_name", "Extract.day", "content_update_date", "Extract.content_title", "Extract.content_slug", "Extract.content_id", "Extract.section_description", "parent_program_id", "dim_contents.content_isactive", "dim_programs.promotional_strategy_id", "sourcesystem_name", "fact_atwork_program_poll_response_activity.poll_key", "Extract.start_date", "fact_atwork_program_poll_response_activity.answer_count", "Extract.organization_asset_size_000", "Extract.program_launch_at", "dim_polls.poll_curriculum_id", "organization_salesforce_account_lead", "dim_organizations.organization_account_lead", "dim_contents.content_update_date", "Extract.organization_id", "content_isactive", "Extract.sourcesystem_id4", "content_create_date", "dim_contents.sourcesystem_id", "Extract.date_key1", "Extract.program_id", "dim_organizations.organization_salesforce_account_lead", "dim_programs.start_date", "dim_programs.program_update_date", "dim_polls.poll_create_date", "dim_organizations.last_admin_login_name", "Extract.city", "Extract.organization_key1", "content_uuid", "dim_contents.content_curriculum_id", "organization_logo_url", "dim_dates.quarter", "month", "dim_contents.content_type", "Extract.organization_school_id", "Extract.organization_uuid", "Extract.content_key1", "Extract.poll_course_key", "Extract.program_update_date", "Extract.parent_program_id", "Extract.section_title", "organization_asset_size_000", "Extract.organization_create_date", "program_id", "poll_content_key", "Extract.year", "[Calculated Field] Organization Answer %", "Extract.answer_count", "dim_organizations.organization_benchmarks", "dim_organizations.organization_slug", "dim_contents.content_slug", "dim_programs.state", "Extract.organization_financial_institution_type", "dim_polls.section_description", "organization_school_id", "promotional_strategy_name", "dim_organizations.organization_id", "program_launch_at", "dim_sourcesystems.sourcesystem_id", "content_curriculum_id", "Extract.content_uuid", "organization_slug", "poll_id", "poll_key (dim_polls)", "organization_key (dim_organizations)", "Extract.audience_id", "content_title", "audience_name", "organization_company_size", "sourcesystem_id (dim_sourcesystems)", "dim_organizations.organization_asset_size_000", "Extract.poll_curriculum_id", "dim_organizations.organization_logo_url", "dim_programs.city", "Extract.sourcesystem_id3", "Extract.state", "audience_id", "dim_programs.parent_program_id", "dim_dates.day_of_year", "dim_programs.program_create_date", "poll_poll_key", "program_slug", "Extract.program_create_date", "organization_industry", "dim_programs.program_id", "active", "organization_salesforce_id", "poll_answer_text", "Extract.organization_aum_tier", "Extract.organization_contract_start_date", "dim_organizations.organization_isactive", "city", "dim_organizations.organization_aum_tier", "Extract.program_key1", "dim_programs.active", "dim_contents.content_create_date", "program_key", "Extract.organization_short_id", "Extract.evaluation_type", "Extract.content_create_date", "Extract.audience_name", "Extract.poll_answer_text", "dim_dates.month", "dim_polls.evaluation_type", "dim_organizations.organization_create_date", "Extract.promotional_strategy_id", "[Calculated Field] Organization Answer Count by Answer", "content_key (dim_contents)", "Extract.organization_slug", "organization_contract_start_date", "dim_organizations.organization_name", "dim_sourcesystems.sourcesystem_name", "Extract.program_slug", "Extract.program_end_at", "Extract.content_curriculum_id", "content_key", "dim_polls.poll_response_choice", "Extract.program_key", "organization_uuid", "dim_dates.day_of_week", "Extract.organization_industry", "dim_organizations.organization_isdemo", "poll_question_text", "dim_organizations.admins_sign_in_count", "Extract.day_of_week", "quarter", "Extract.week", "sourcesystem_id (dim_polls)", "fact_atwork_program_poll_response_activity.content_key", "Extract.content_type", "poll_update_date", "date_key", "Extract.organization_institution_type", "poll_response_choice", "subsourcesystem_name", "dim_programs.promotional_strategy_name", "dim_polls.poll_activity_id", "dim_polls.poll_update_date", "dim_dates.last_date_of_month", "poll_create_date", "Extract.organization_company_size", "fact_atwork_program_poll_response_activity.organization_key", "Extract.organization_isdemo", "organization_name", "organization_key", "Extract.poll_key", "dim_contents.content_id", "Extract.content_isactive", "poll_key", "dim_organizations.organization_financial_institution_type", "dim_dates.date_key", "Extract.quarter", "Extract.subsourcesystem_name1", "program_key (dim_programs)", "dim_polls.poll_question_text", "poll_curriculum_id", "organization_institution_type", "fact_atwork_program_poll_response_activity.user_response", "Extract.subsourcesystem_name", "dim_programs.sourcesystem_id", "date", "Extract.organization_legacy_import_id", "program_create_date", "dim_programs.program_name", "fact_atwork_program_poll_response_activity.sourcesystem_id", "Extract.program_name", "dim_dates.day", "Extract.organization_key", "dim_dates.date", "Extract.poll_question_text", "week", "dim_programs.program_key", "content_id", "dim_polls.poll_course_key", "dim_organizations.organization_key", "Extract.program_type", "Extract.poll_activity_id", "dim_organizations.subsourcesystem_name", "[Calculated Field] Organization Answer Count by Question", "dim_contents.content_uuid", "Extract.organization_logo_url", "Extract.sourcesystem_id", "Extract.sourcesystem_id2", "program_type", "dim_dates.month_name", "year", "organization_isdemo", "dim_organizations.organization_company_size", "Extract.poll_response_choice", "Extract.user_response", "sourcesystem_id (dim_programs)", "Extract.organization_isactive", "dim_dates.week", "dim_polls.section_title", "day", "organization_id", "fact_atwork_program_poll_response_activity.date_key", "dim_programs.audience_name", "dim_organizations.organization_short_id", "dim_organizations.sourcesystem_id", "Extract.content_key", "Extract.organization_account_lead", "day_of_week", "organization_account_lead", "organization_create_date", "Extract.poll_content_key", "dim_programs.program_slug", "Extract.organization_benchmarks", "program_update_date", "dim_polls.sourcesystem_id", "Extract.admins_sign_in_count", "content_type", "poll_activity_id", "date_key (dim_dates)", "dim_programs.audience_id", "dim_organizations.organization_legacy_import_id", "Extract.organization_delete_date", "program_name", "dim_dates.weekday_name", "Extract.month", "dim_programs.program_end_at", "Extract.promotional_strategy_name", "Extract.last_admin_login_date", "Extract.sourcesystem_id1", "organization_benchmarks", "state", "Extract.poll_update_date", "Extract.day_of_year", "subsourcesystem_name (dim_contents)", "dim_polls.poll_id", "dim_polls.poll_answer_text", "dim_organizations.organization_uuid", "Extract.last_admin_login_name", "poll_course_key", "dim_organizations.organization_institution_type", "dim_programs.program_type", "dim_dates.year", "Extract.organization_salesforce_account_lead", "dim_organizations.organization_salesforce_id", "Extract.date", "dim_organizations.last_admin_login_date", "Extract.last_date_of_month", "Extract.sourcesystem_id5", "dim_polls.poll_content_key"], "initial_sql": [], "custom_sql": []}}